# ğŸ—ï¸ Ğ¢ĞµÑ…Ğ½Ñ–Ñ‡Ğ½Ğ° Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°: Massage Bot TMA

## ğŸ“‹ Ğ—Ğ¼Ñ–ÑÑ‚
1. [Ğ—Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ Ğ²Ğ¸Ğ¼Ğ¾Ğ³](#1-Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ-Ğ²Ğ¸Ğ¼Ğ¾Ğ³)
2. [Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚ĞµĞº](#2-Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹-ÑÑ‚ĞµĞº)
3. [ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸](#3-Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸)
4. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ‘Ğ”](#4-ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ±Ğ´)
5. [Frontend Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#5-frontend-Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
6. [Backend Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#6-backend-Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
7. [Telegram Bot](#7-telegram-bot)
8. [Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ](#8-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°-ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ)
9. [ĞŸĞ»Ğ°Ñ‚Ñ–Ğ¶Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°](#9-Ğ¿Ğ»Ğ°Ñ‚Ñ–Ğ¶Ğ½Ğ°-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°)
10. [ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ñ–](#10-Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ°-Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ñ–)
11. [i18n â€” ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¼Ğ¾Ğ²Ğ½Ñ–ÑÑ‚ÑŒ](#11-i18n--Ğ¼ÑƒĞ»ÑŒÑ‚Ğ¸Ğ¼Ğ¾Ğ²Ğ½Ñ–ÑÑ‚ÑŒ)
12. [Ğ Ğ¾Ğ»Ñ– Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿](#12-Ñ€Ğ¾Ğ»Ñ–-Ñ‚Ğ°-Ğ´Ğ¾ÑÑ‚ÑƒĞ¿)
13. [CI/CD Ñ‚Ğ° Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹](#13-cicd-Ñ‚Ğ°-Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹)
14. [ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—](#14-Ğ¿Ğ»Ğ°Ğ½-Ñ€ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—)

---

## 1. Ğ—Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ Ğ²Ğ¸Ğ¼Ğ¾Ğ³

### Ğ‘Ñ–Ğ·Ğ½ĞµÑ-Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ |
|----------|----------|
| ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ñ–Ğ² | 8-15 |
| ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»ÑƒĞ³ | 16-30 Ğ· Ñ–Ñ”Ñ€Ğ°Ñ€Ñ…Ñ–Ñ”Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ğ¹ |
| ĞšĞ¾Ğ¼Ğ±Ğ¾-Ğ¿Ğ°ĞºĞµÑ‚Ğ¸ | Ğ¢Ğ°Ğº |
| ĞšÑ–Ğ»ÑŒĞºĞ° Ğ¿Ğ¾ÑĞ»ÑƒĞ³ Ğ·Ğ° Ğ²Ñ–Ğ·Ğ¸Ñ‚ | Ğ¢Ğ°Ğº |
| Ğ¢Ñ€Ğ¸Ğ²Ğ°Ğ»Ñ–ÑÑ‚ÑŒ | ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ Ğ¾Ğ±Ğ¸Ñ€Ğ°Ñ”: 30/60/90 Ñ…Ğ² |
| Ğ“Ñ€Ğ°Ñ„Ñ–Ğº | Ğ“Ğ½ÑƒÑ‡ĞºĞ¸Ğ¹, Ğ·Ğ°Ğ´Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ½Ğ° Ñ‚Ğ¸Ğ¶Ğ´ĞµĞ½ÑŒ |
| Ğ‘Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ğ¿ĞµÑ€ĞµĞ´ | 14 Ğ´Ğ½Ñ–Ğ² |
| ĞšÑ€Ğ¾Ğº Ñ‡Ğ°ÑÑƒ | 15 Ñ…Ğ²Ğ¸Ğ»Ğ¸Ğ½ |
| Ğ‘ÑƒÑ„ĞµÑ€ Ğ¼Ñ–Ğ¶ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ¼Ğ¸ | ĞĞ°Ğ»Ğ°ÑˆÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ¾Ğ¼ |
| Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ğ½Ğ½Ñ | Ğ—Ğ° 2 Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ¸ (Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ) |
| ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½Ñ | Ğ—Ğ°Ğ»ĞµĞ¶Ğ¸Ñ‚ÑŒ Ğ²Ñ–Ğ´ Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ğ¸ |
| ĞĞ½Ğ»Ğ°Ğ¹Ğ½-Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ° | Portmone, Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğ° Ğ¿ĞµÑ€ĞµĞ´Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ° |
| Ğ”ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚ | Ğ¤Ñ–ĞºÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ²Ñ–Ğ´ÑĞ¾Ñ‚Ğ¾Ğº (Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ) |
| Ğ¦Ñ–Ğ½Ğ¸ | Ğ—Ğ°Ğ»ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ²Ñ–Ğ´ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ° |
| ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ğ¸ | Ğ¢Ğ°Ğº |
| Ğ›Ğ¾ÑĞ»ÑŒĞ½Ñ–ÑÑ‚ÑŒ | Ğ¨Ñ‚Ğ°Ğ¼Ğ¿Ğ¸: ĞºĞ¾Ğ¶ĞµĞ½ N-Ğ¹ Ğ²Ñ–Ğ·Ğ¸Ñ‚ Ğ±ĞµĞ·ĞºĞ¾ÑˆÑ‚Ğ¾Ğ²Ğ½Ğ¾ |
| Ğ Ğ¾Ğ»Ñ– | Ğ’Ğ»Ğ°ÑĞ½Ğ¸Ğº, ĞĞ´Ğ¼Ñ–Ğ½, ĞœĞ°Ğ¹ÑÑ‚ĞµÑ€, ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ |
| Ğ¡Ğ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ | Telegram Bot |
| ĞœĞ¾Ğ²Ğ¸ | UA/EN/RU, Ğ°Ğ²Ñ‚Ğ¾Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ |
| ĞĞ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ | 1-10 Ğ·Ğ°Ğ¿Ğ¸ÑÑ–Ğ²/Ğ´ĞµĞ½ÑŒ |

---

## 2. Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚ĞµĞº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND                          â”‚
â”‚  React 18 + TypeScript + Vite                       â”‚
â”‚  Telegram Mini App SDK (@telegram-apps/sdk-react)   â”‚
â”‚  TailwindCSS + Framer Motion                        â”‚
â”‚  React Query (TanStack Query)                       â”‚
â”‚  Zustand (state management)                         â”‚
â”‚  react-i18next (Ğ»Ğ¾ĞºĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ)                        â”‚
â”‚  Swiper.js (ĞºĞ°Ñ€ÑƒÑĞµĞ»Ñ–)                               â”‚
â”‚  react-calendar / date-fns                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    BACKEND                           â”‚
â”‚  Node.js + TypeScript + Fastify                     â”‚
â”‚  Prisma ORM                                         â”‚
â”‚  Grammy (Telegram Bot Framework)                    â”‚
â”‚  Bull MQ (Ñ‡ĞµÑ€Ğ³Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡: ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ, cron)            â”‚
â”‚  Zod (Ğ²Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ)                                    â”‚
â”‚  JWT + Telegram InitData validation                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   DATABASE                           â”‚
â”‚  PostgreSQL (Supabase / Railway)                    â”‚
â”‚  Redis (Bull MQ, ĞºĞµÑˆ ÑĞµÑÑ–Ğ¹)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   HOSTING                            â”‚
â”‚  Frontend: Vercel                                   â”‚
â”‚  Backend: Railway                                   â”‚
â”‚  DB: Supabase (PostgreSQL) + Railway (Redis)        â”‚
â”‚  CI/CD: GitHub Actions                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞĞ±Ò‘Ñ€ÑƒĞ½Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ğ¸Ğ±Ğ¾Ñ€Ñƒ

| Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ | Ğ§Ğ¾Ğ¼Ñƒ |
|------------|------|
| **React + Vite** | ĞĞ°Ğ¹ĞºÑ€Ğ°Ñ‰Ğ° Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ° TMA SDK, ÑˆĞ²Ğ¸Ğ´ĞºĞ¸Ğ¹ HMR, Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ğ¹ ĞµĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼ |
| **Fastify** | Ğ¨Ğ²Ğ¸Ğ´ÑˆĞ¸Ğ¹ Ğ·Ğ° Express Ñƒ 2-3 Ñ€Ğ°Ğ·Ğ¸, TypeScript-first, Ğ¿Ğ»Ğ°Ğ³Ñ–Ğ½Ğ½Ğ° Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° |
| **Prisma** | Type-safe ORM, Ğ°Ğ²Ñ‚Ğ¾Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ñ‚Ğ¸Ğ¿Ñ–Ğ², Ğ¼Ñ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ—, Ñ‡ÑƒĞ´Ğ¾Ğ²Ğ° DX |
| **Grammy** | Ğ¡ÑƒÑ‡Ğ°ÑĞ½Ğ¸Ğ¹ TG Bot framework Ğ´Ğ»Ñ Node.js, Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ° middleware |
| **TailwindCSS** | Ğ¨Ğ²Ğ¸Ğ´ĞºĞ° ÑÑ‚Ğ¸Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ, responsive, Ñ‚ĞµĞ¼Ğ½Ğ° Ñ‚ĞµĞ¼Ğ° Ğ· ĞºĞ¾Ñ€Ğ¾Ğ±ĞºĞ¸ |
| **Framer Motion** | Premium Ğ°Ğ½Ñ–Ğ¼Ğ°Ñ†Ñ–Ñ— Ğ´Ğ»Ñ React, gesture support |
| **Zustand** | Ğ›ĞµĞ³ĞºĞ¸Ğ¹ state manager, Ğ¼ĞµĞ½ÑˆĞµ boilerplate Ğ½Ñ–Ğ¶ Redux |
| **Bull MQ** | ĞĞ°Ğ´Ñ–Ğ¹Ğ½Ñ– Ñ‡ĞµÑ€Ğ³Ğ¸ Ğ´Ğ»Ñ Ğ²Ñ–Ğ´ĞºĞ»Ğ°Ğ´ĞµĞ½Ğ¸Ñ… ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ Ñ‚Ğ° cron-Ğ·Ğ°Ğ´Ğ°Ñ‡ |
| **Supabase** | Managed PostgreSQL, Ğ±ĞµĞ·ĞºĞ¾ÑˆÑ‚Ğ¾Ğ²Ğ½Ğ¸Ğ¹ tier, Row Level Security |

---

## 3. ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸

```mermaid
graph TB
    subgraph Client
        TMA[Telegram Mini App - React]
        TG_BOT_UI[Telegram Bot Chat]
    end

    subgraph Backend
        API[Fastify API Server]
        BOT[Grammy Bot Handler]
        QUEUE[Bull MQ Worker]
        CRON[Cron Scheduler]
    end

    subgraph Storage
        PG[(PostgreSQL - Supabase)]
        REDIS[(Redis - Railway)]
    end

    subgraph External
        PORTMONE[Portmone Payment]
        GCAL[Google Calendar API]
        GMAPS[Google Maps Embed]
    end

    TMA -->|REST API + JWT| API
    TG_BOT_UI -->|Webhook| BOT
    BOT -->|Enqueue| REDIS
    API -->|Prisma| PG
    API -->|Cache + Queue| REDIS
    QUEUE -->|Read jobs| REDIS
    QUEUE -->|Send notifications| BOT
    CRON -->|Schedule jobs| REDIS
    API -->|Payment| PORTMONE
    API -->|Sync| GCAL
    TMA -->|Embed| GMAPS
```

### ĞŸĞ¾Ñ‚Ñ–Ğº Ğ°Ğ²Ñ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ—

```mermaid
sequenceDiagram
    participant U as User
    participant TG as Telegram
    participant TMA as Mini App
    participant API as Backend API
    participant DB as PostgreSQL

    U->>TG: /start
    TG->>U: Welcome + WebApp Button
    U->>TMA: Open Mini App
    TMA->>TMA: Get initData from TG SDK
    TMA->>API: POST /auth/telegram with initData
    API->>API: Validate initData signature
    API->>DB: Find or Create User
    API->>TMA: JWT Token + User Profile
    TMA->>TMA: Store token in memory
```

---

## 4. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ‘Ğ”

### ER-Ğ´Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ°

```mermaid
erDiagram
    users ||--o{ bookings : makes
    users ||--o{ reviews : writes
    users ||--o{ loyalty_stamps : earns
    users {
        uuid id PK
        bigint telegram_id UK
        varchar telegram_username
        varchar first_name
        varchar last_name
        varchar phone
        varchar avatar_url
        enum role
        varchar language
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    service_categories ||--o{ service_categories : has_children
    service_categories ||--o{ services : contains
    service_categories {
        uuid id PK
        uuid parent_id FK
        jsonb name
        jsonb description
        varchar image_url
        int sort_order
        boolean is_active
    }

    services ||--o{ service_durations : has
    services ||--o{ master_services : offered_by
    services ||--o{ booking_items : booked_in
    services ||--o{ combo_items : part_of
    services {
        uuid id PK
        uuid category_id FK
        jsonb name
        jsonb description
        varchar image_url
        boolean requires_confirmation
        boolean is_active
        int sort_order
        timestamp created_at
    }

    service_durations {
        uuid id PK
        uuid service_id FK
        int duration_minutes
        decimal base_price
        boolean is_active
    }

    masters ||--o{ master_services : provides
    masters ||--o{ master_schedules : has_schedule
    masters ||--o{ bookings : serves
    masters ||--o{ reviews : receives
    masters {
        uuid id PK
        uuid user_id FK
        jsonb display_name
        jsonb bio
        varchar photo_url
        varchar specialization
        boolean is_active
        int sort_order
        timestamp created_at
    }

    master_services {
        uuid id PK
        uuid master_id FK
        uuid service_id FK
        decimal price_modifier
    }

    master_schedules {
        uuid id PK
        uuid master_id FK
        date work_date
        time start_time
        time end_time
        boolean is_day_off
    }

    combos ||--o{ combo_items : includes
    combos {
        uuid id PK
        jsonb name
        jsonb description
        varchar image_url
        decimal discount_percent
        boolean is_active
        int sort_order
    }

    combo_items {
        uuid id PK
        uuid combo_id FK
        uuid service_id FK
        uuid duration_id FK
        int sort_order
    }

    bookings ||--o{ booking_items : contains
    bookings ||--o{ payments : paid_by
    bookings ||--o{ notifications : triggers
    bookings {
        uuid id PK
        uuid user_id FK
        uuid master_id FK
        date booking_date
        time start_time
        time end_time
        enum status
        decimal total_price
        decimal deposit_amount
        decimal deposit_percent
        uuid promo_code_id FK
        decimal discount_amount
        text admin_notes
        text cancel_reason
        timestamp created_at
        timestamp updated_at
    }

    booking_items {
        uuid id PK
        uuid booking_id FK
        uuid service_id FK
        uuid duration_id FK
        decimal price
        int sort_order
    }

    payments {
        uuid id PK
        uuid booking_id FK
        uuid user_id FK
        decimal amount
        enum type
        enum status
        varchar provider_tx_id
        jsonb provider_response
        timestamp created_at
    }

    reviews {
        uuid id PK
        uuid user_id FK
        uuid master_id FK
        uuid booking_id FK
        int rating
        text comment
        enum status
        timestamp created_at
    }

    promo_codes ||--o{ bookings : applied_to
    promo_codes {
        uuid id PK
        varchar code UK
        enum discount_type
        decimal discount_value
        decimal min_order_amount
        int max_uses
        int current_uses
        timestamp valid_from
        timestamp valid_until
        boolean is_active
    }

    loyalty_stamps {
        uuid id PK
        uuid user_id FK
        uuid booking_id FK
        int stamp_number
        boolean is_reward
        timestamp created_at
    }

    loyalty_settings {
        uuid id PK
        int stamps_for_reward
        jsonb eligible_services
        boolean is_active
    }

    notifications {
        uuid id PK
        uuid user_id FK
        uuid booking_id FK
        enum type
        enum channel
        enum status
        jsonb payload
        timestamp scheduled_at
        timestamp sent_at
    }

    waitlist {
        uuid id PK
        uuid user_id FK
        uuid service_id FK
        uuid master_id FK
        date preferred_date
        time preferred_start
        time preferred_end
        enum status
        timestamp created_at
    }

    promotions {
        uuid id PK
        jsonb title
        jsonb description
        varchar image_url
        timestamp start_date
        timestamp end_date
        boolean is_active
        int sort_order
    }

    site_settings {
        uuid id PK
        varchar key UK
        jsonb value
        timestamp updated_at
    }

    google_calendar_sync {
        uuid id PK
        uuid master_id FK
        varchar google_calendar_id
        varchar refresh_token
        timestamp last_synced_at
        boolean is_active
    }
```

### Enum-Ñ‚Ğ¸Ğ¿Ğ¸

```sql
-- Ğ Ğ¾Ğ»Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²
CREATE TYPE user_role AS ENUM ('client', 'master', 'admin', 'owner');

-- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑĞ¸ Ğ±Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ
CREATE TYPE booking_status AS ENUM (
    'pending_confirmation',  -- ĞÑ‡Ñ–ĞºÑƒÑ” Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½Ñ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ¾Ğ¼
    'confirmed',             -- ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ¾
    'deposit_pending',       -- ĞÑ‡Ñ–ĞºÑƒÑ” Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸ Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ñƒ
    'deposit_paid',          -- Ğ”ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚ Ğ¾Ğ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ¾
    'in_progress',           -- Ğ’Ğ¸ĞºĞ¾Ğ½ÑƒÑ”Ñ‚ÑŒÑÑ
    'completed',             -- Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾
    'cancelled_by_client',   -- Ğ¡ĞºĞ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ¾Ğ¼
    'cancelled_by_admin',    -- Ğ¡ĞºĞ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ¾Ğ¼
    'no_show'                -- ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ Ğ½Ğµ Ğ·'ÑĞ²Ğ¸Ğ²ÑÑ
);

-- Ğ¢Ğ¸Ğ¿Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸
CREATE TYPE payment_type AS ENUM ('deposit', 'full', 'refund');
CREATE TYPE payment_status AS ENUM ('pending', 'success', 'failed', 'refunded');

-- Ğ¢Ğ¸Ğ¿Ğ¸ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ
CREATE TYPE notification_type AS ENUM (
    'booking_created',
    'booking_confirmed',
    'booking_cancelled',
    'reminder_24h',
    'reminder_2h',
    'review_request',
    'promotion',
    'schedule_daily',
    'waitlist_available'
);

-- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑĞ¸ Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑ–Ğ²
CREATE TYPE review_status AS ENUM ('pending', 'approved', 'rejected');

-- Ğ¢Ğ¸Ğ¿Ğ¸ Ğ·Ğ½Ğ¸Ğ¶Ğ¾Ğº
CREATE TYPE discount_type AS ENUM ('percent', 'fixed');

-- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑĞ¸ ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¾Ñ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ
CREATE TYPE waitlist_status AS ENUM ('active', 'notified', 'booked', 'expired');
```

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– Ñ–Ğ½Ğ´ĞµĞºÑĞ¸

```sql
-- Ğ¨Ğ²Ğ¸Ğ´ĞºĞ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº Ğ²Ñ–Ğ»ÑŒĞ½Ğ¸Ñ… ÑĞ»Ğ¾Ñ‚Ñ–Ğ²
CREATE INDEX idx_master_schedules_date ON master_schedules(master_id, work_date);
CREATE INDEX idx_bookings_master_date ON bookings(master_id, booking_date, status);

-- ĞŸĞ¾ÑˆÑƒĞº ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ğ¿Ğ¾ Telegram ID
CREATE UNIQUE INDEX idx_users_telegram_id ON users(telegram_id);

-- Ğ¡Ğ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
CREATE INDEX idx_notifications_scheduled ON notifications(scheduled_at, status);

-- ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ğ¸
CREATE UNIQUE INDEX idx_promo_codes_code ON promo_codes(code);
```

---

## 5. Frontend Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾Ñ”ĞºÑ‚Ñƒ

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ App.tsx                    # Root component
â”‚   â”œâ”€â”€ Router.tsx                 # React Router config
â”‚   â””â”€â”€ providers/
â”‚       â”œâ”€â”€ TelegramProvider.tsx   # TMA SDK init
â”‚       â”œâ”€â”€ AuthProvider.tsx       # JWT auth context
â”‚       â”œâ”€â”€ QueryProvider.tsx      # React Query
â”‚       â””â”€â”€ I18nProvider.tsx       # i18next
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroSection.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AboutSection.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PromotionsCarousel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ServicesCarousel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MastersCarousel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewsCarousel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ GoogleMapSection.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BookingCTA.tsx
â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”‚       â””â”€â”€ useHomeData.ts
â”‚   â”œâ”€â”€ booking/
â”‚   â”‚   â”œâ”€â”€ BookingPage.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ BookingWizard.tsx       # Step container
â”‚   â”‚   â”‚   â”œâ”€â”€ ServiceStep.tsx         # Step 1: Choose service
â”‚   â”‚   â”‚   â”œâ”€â”€ MasterStep.tsx          # Step 2: Choose master
â”‚   â”‚   â”‚   â”œâ”€â”€ DateTimeStep.tsx        # Step 3: Date and time
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfirmStep.tsx         # Step 4: Summary + pay
â”‚   â”‚   â”‚   â”œâ”€â”€ ServiceCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MasterCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TimeSlotGrid.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarPicker.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PromoCodeInput.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useBookingWizard.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useAvailableSlots.ts
â”‚   â”‚   â”‚   â””â”€â”€ useCreateBooking.ts
â”‚   â”‚   â””â”€â”€ store/
â”‚   â”‚       â””â”€â”€ bookingStore.ts         # Zustand store
â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ ProfilePage.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileHeader.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LoyaltyCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BookingHistory.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BookingHistoryItem.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LanguageSwitcher.tsx
â”‚   â”‚   â”‚   â””â”€â”€ QuickRebook.tsx
â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”‚       â”œâ”€â”€ useProfile.ts
â”‚   â”‚       â””â”€â”€ useLoyalty.ts
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ AdminLayout.tsx
â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ ServicesListPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ServiceFormPage.tsx
â”‚   â”‚   â”œâ”€â”€ masters/
â”‚   â”‚   â”‚   â”œâ”€â”€ MastersListPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ MasterFormPage.tsx
â”‚   â”‚   â”œâ”€â”€ bookings/
â”‚   â”‚   â”‚   â”œâ”€â”€ BookingsListPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BookingDetailPage.tsx
â”‚   â”‚   â”œâ”€â”€ schedule/
â”‚   â”‚   â”‚   â””â”€â”€ ScheduleManagerPage.tsx
â”‚   â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”‚   â”œâ”€â”€ PromotionsPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewsModerationPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SiteSettingsPage.tsx
â”‚   â”‚   â”œâ”€â”€ promo-codes/
â”‚   â”‚   â”‚   â””â”€â”€ PromoCodesPage.tsx
â”‚   â”‚   â”œâ”€â”€ loyalty/
â”‚   â”‚   â”‚   â””â”€â”€ LoyaltySettingsPage.tsx
â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”‚   â””â”€â”€ AnalyticsPage.tsx
â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚       â””â”€â”€ UsersManagementPage.tsx
â”‚   â””â”€â”€ master/
â”‚       â”œâ”€â”€ MasterLayout.tsx
â”‚       â”œâ”€â”€ MasterSchedulePage.tsx
â”‚       â”œâ”€â”€ MasterBookingsPage.tsx
â”‚       â””â”€â”€ MasterStatsPage.tsx
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ client.ts               # Axios/fetch wrapper
â”‚   â”‚   â”œâ”€â”€ auth.api.ts
â”‚   â”‚   â”œâ”€â”€ bookings.api.ts
â”‚   â”‚   â”œâ”€â”€ services.api.ts
â”‚   â”‚   â”œâ”€â”€ masters.api.ts
â”‚   â”‚   â”œâ”€â”€ reviews.api.ts
â”‚   â”‚   â”œâ”€â”€ payments.api.ts
â”‚   â”‚   â””â”€â”€ admin.api.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                     # Base UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Skeleton.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Avatar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StarRating.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Toast.tsx
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppLayout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ Carousel.tsx            # Reusable Swiper wrapper
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useTelegram.ts
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ useTheme.ts
â”‚   â”œâ”€â”€ i18n/
â”‚   â”‚   â”œâ”€â”€ config.ts
â”‚   â”‚   â”œâ”€â”€ locales/
â”‚   â”‚   â”‚   â”œâ”€â”€ uk.json
â”‚   â”‚   â”‚   â”œâ”€â”€ en.json
â”‚   â”‚   â”‚   â””â”€â”€ ru.json
â”‚   â”‚   â””â”€â”€ useTranslatedContent.ts  # Hook for DB content
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ service.ts
â”‚   â”‚   â”œâ”€â”€ booking.ts
â”‚   â”‚   â”œâ”€â”€ master.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ date.ts
â”‚       â”œâ”€â”€ price.ts
â”‚       â””â”€â”€ validation.ts
â””â”€â”€ assets/
    â”œâ”€â”€ icons/
    â””â”€â”€ images/
```

### Ğ Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³

```typescript
// Router.tsx
const routes = [
  // ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ñ– ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ¸
  { path: '/',           element: <HomePage /> },
  { path: '/booking',    element: <BookingPage /> },
  { path: '/profile',    element: <ProfilePage />,    auth: 'client' },

  // ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ°
  { path: '/master',           element: <MasterLayout />,    auth: 'master' },
  { path: '/master/schedule',  element: <MasterSchedulePage /> },
  { path: '/master/bookings',  element: <MasterBookingsPage /> },
  { path: '/master/stats',     element: <MasterStatsPage /> },

  // ĞĞ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
  { path: '/admin',              element: <AdminLayout />,     auth: 'admin' },
  { path: '/admin/dashboard',    element: <DashboardPage /> },
  { path: '/admin/services',     element: <ServicesListPage /> },
  { path: '/admin/masters',      element: <MastersListPage /> },
  { path: '/admin/bookings',     element: <BookingsListPage /> },
  { path: '/admin/schedule',     element: <ScheduleManagerPage /> },
  { path: '/admin/promotions',   element: <PromotionsPage /> },
  { path: '/admin/reviews',      element: <ReviewsModerationPage /> },
  { path: '/admin/promo-codes',  element: <PromoCodesPage /> },
  { path: '/admin/loyalty',      element: <LoyaltySettingsPage /> },
  { path: '/admin/analytics',    element: <AnalyticsPage /> },
  { path: '/admin/settings',     element: <SiteSettingsPage /> },
  { path: '/admin/users',        element: <UsersManagementPage /> },
];
```

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸

#### BookingWizard â€” ĞŸĞ¾Ñ‚Ñ–Ğº Ğ±Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ

```mermaid
stateDiagram-v2
    [*] --> SelectService
    SelectService --> SelectMaster: Service chosen
    SelectService --> SelectMaster: Skip master - auto assign
    SelectMaster --> SelectDateTime: Master chosen
    SelectDateTime --> Confirmation: Date and time chosen
    Confirmation --> Payment: Confirm booking
    Payment --> Success: Payment OK
    Payment --> Confirmation: Payment failed
    Confirmation --> SelectDateTime: Back
    SelectDateTime --> SelectMaster: Back
    SelectMaster --> SelectService: Back
    Success --> [*]
```

#### ĞšĞ°Ñ€ÑƒÑĞµĞ»Ñ– Ğ½Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ñ–Ğ¹

Ğ’ÑÑ– 4 ĞºĞ°Ñ€ÑƒÑĞµĞ»Ñ– Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑÑ‚ÑŒ ÑĞ¿Ñ–Ğ»ÑŒĞ½Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ `Carousel.tsx` Ğ½Ğ° Ğ±Ğ°Ğ·Ñ– Swiper.js:
- **ĞĞºÑ†Ñ–Ñ—** â€” Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ ÑĞ»Ğ°Ğ¹Ğ´ĞµÑ€ Ğ· Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ğ¼Ğ¸ Ğ±Ğ°Ğ½ĞµÑ€Ğ°Ğ¼Ğ¸, autoplay
- **ĞŸĞ¾ÑĞ»ÑƒĞ³Ğ¸** â€” ĞºĞ°Ñ€Ñ‚ĞºĞ¸ Ğ· Ñ–ĞºĞ¾Ğ½ĞºĞ¾Ñ, Ğ½Ğ°Ğ·Ğ²Ğ¾Ñ, Ñ†Ñ–Ğ½Ğ¾Ñ Ğ²Ñ–Ğ´
- **ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»** â€” Ñ„Ğ¾Ñ‚Ğ¾, Ñ–Ğ¼'Ñ, ÑĞ¿ĞµÑ†Ñ–Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ, Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³
- **Ğ’Ñ–Ğ´Ğ³ÑƒĞºĞ¸** â€” Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°, Ğ·Ñ–Ñ€ĞºĞ¸, Ñ‚ĞµĞºÑÑ‚, Ğ´Ğ°Ñ‚Ğ°

#### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ‚ĞµĞ¼

TMA Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ” Ñ‚ĞµĞ¼Ñƒ Ğ²Ñ–Ğ´ Telegram (light/dark). Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ CSS-Ğ·Ğ¼Ñ–Ğ½Ğ½Ñ– Telegram + TailwindCSS dark mode.

---

## 6. Backend Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾Ñ”ĞºÑ‚Ñƒ

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                      # Fastify app init
â”‚   â”œâ”€â”€ server.ts                   # Entry point
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ env.ts                  # Environment variables
â”‚   â”‚   â”œâ”€â”€ database.ts             # Prisma client
â”‚   â”‚   â””â”€â”€ redis.ts                # Redis connection
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.schema.ts      # Zod schemas
â”‚   â”‚   â”‚   â””â”€â”€ telegram.guard.ts   # InitData validation
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ users.schema.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ services.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ services.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ services.schema.ts
â”‚   â”‚   â”œâ”€â”€ masters/
â”‚   â”‚   â”‚   â”œâ”€â”€ masters.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ masters.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ masters.schema.ts
â”‚   â”‚   â”œâ”€â”€ bookings/
â”‚   â”‚   â”‚   â”œâ”€â”€ bookings.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ bookings.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ bookings.schema.ts
â”‚   â”‚   â”‚   â””â”€â”€ slots.service.ts    # Available slots logic
â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â”œâ”€â”€ payments.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ payments.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ portmone.client.ts
â”‚   â”‚   â”œâ”€â”€ reviews/
â”‚   â”‚   â”‚   â”œâ”€â”€ reviews.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ reviews.service.ts
â”‚   â”‚   â”œâ”€â”€ loyalty/
â”‚   â”‚   â”‚   â”œâ”€â”€ loyalty.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ loyalty.service.ts
â”‚   â”‚   â”œâ”€â”€ promo-codes/
â”‚   â”‚   â”‚   â”œâ”€â”€ promo.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ promo.service.ts
â”‚   â”‚   â”œâ”€â”€ waitlist/
â”‚   â”‚   â”‚   â”œâ”€â”€ waitlist.controller.ts
â”‚   â”‚   â”‚   â””â”€â”€ waitlist.service.ts
â”‚   â”‚   â”œâ”€â”€ notifications/
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications.worker.ts  # Bull MQ worker
â”‚   â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚   â”‚       â”œâ”€â”€ booking-created.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ booking-confirmed.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ reminder.ts
â”‚   â”‚   â”‚       â””â”€â”€ review-request.ts
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.controller.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ settings.service.ts
â”‚   â”‚   â””â”€â”€ calendar/
â”‚   â”‚       â”œâ”€â”€ gcal.controller.ts
â”‚   â”‚       â””â”€â”€ gcal.service.ts
â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â”œâ”€â”€ bot.ts                  # Grammy bot init
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â””â”€â”€ start.ts
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â””â”€â”€ callback.ts
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â””â”€â”€ auth.ts
â”‚   â”œâ”€â”€ jobs/
â”‚   â”‚   â”œâ”€â”€ scheduler.ts            # Cron jobs setup
â”‚   â”‚   â”œâ”€â”€ reminder.job.ts
â”‚   â”‚   â”œâ”€â”€ daily-schedule.job.ts
â”‚   â”‚   â”œâ”€â”€ review-request.job.ts
â”‚   â”‚   â””â”€â”€ waitlist-check.job.ts
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ role.middleware.ts
â”‚   â”‚   â”‚   â””â”€â”€ error.middleware.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ date.ts
â”‚   â”‚   â”‚   â””â”€â”€ pagination.ts
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â””â”€â”€ prisma/
â”‚       â”œâ”€â”€ schema.prisma
â”‚       â”œâ”€â”€ migrations/
â”‚       â””â”€â”€ seed.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env.example
```

### API Endpoints

#### Auth
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| POST | `/api/auth/telegram` | ĞĞ²Ñ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ Ñ‡ĞµÑ€ĞµĞ· TG initData | Public |
| GET | `/api/auth/me` | ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ | Auth |

#### Services
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| GET | `/api/services` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾ÑĞ»ÑƒĞ³ Ğ· ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–ÑĞ¼Ğ¸ | Public |
| GET | `/api/services/:id` | Ğ”ĞµÑ‚Ğ°Ğ»Ñ– Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ğ¸ | Public |
| GET | `/api/services/categories` | Ğ”ĞµÑ€ĞµĞ²Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ğ¹ | Public |
| GET | `/api/combos` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ±Ğ¾-Ğ¿Ğ°ĞºĞµÑ‚Ñ–Ğ² | Public |
| POST | `/api/admin/services` | Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ñƒ | Admin |
| PUT | `/api/admin/services/:id` | ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ñƒ | Admin |
| DELETE | `/api/admin/services/:id` | Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ñƒ | Admin |

#### Masters
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| GET | `/api/masters` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ñ–Ğ² | Public |
| GET | `/api/masters/:id` | ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ° | Public |
| GET | `/api/masters/:id/services` | ĞŸĞ¾ÑĞ»ÑƒĞ³Ğ¸ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ° | Public |
| GET | `/api/masters/:id/reviews` | Ğ’Ñ–Ğ´Ğ³ÑƒĞºĞ¸ Ğ¿Ñ€Ğ¾ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ° | Public |
| GET | `/api/masters/available` | Ğ’Ñ–Ğ»ÑŒĞ½Ñ– Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ğ¸ | Public |

#### Bookings
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| GET | `/api/bookings/slots` | Ğ’Ñ–Ğ»ÑŒĞ½Ñ– ÑĞ»Ğ¾Ñ‚Ğ¸ | Auth |
| POST | `/api/bookings` | Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ±Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ | Auth |
| GET | `/api/bookings/my` | ĞœĞ¾Ñ— Ğ±Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ | Auth |
| GET | `/api/bookings/:id` | Ğ”ĞµÑ‚Ğ°Ğ»Ñ– Ğ±Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ | Auth |
| POST | `/api/bookings/:id/cancel` | Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸ | Auth |
| POST | `/api/bookings/:id/rebook` | ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ğ¸Ñ | Auth |
| PUT | `/api/admin/bookings/:id` | ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑ | Admin |
| GET | `/api/master/bookings` | Ğ—Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ° | Master |
| POST | `/api/master/bookings/:id/complete` | Ğ’Ñ–Ğ´Ğ¼Ñ–Ñ‚Ğ¸Ñ‚Ğ¸ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ | Master |
| POST | `/api/master/bookings/:id/no-show` | Ğ’Ñ–Ğ´Ğ¼Ñ–Ñ‚Ğ¸Ñ‚Ğ¸ Ğ½Ğµ Ğ·'ÑĞ²Ğ¸Ğ²ÑÑ | Master |

#### Payments
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| POST | `/api/payments/create` | Ğ†Ğ½Ñ–Ñ†Ñ–ÑĞ²Ğ°Ñ‚Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ | Auth |
| POST | `/api/payments/callback` | Webhook Ğ²Ñ–Ğ´ Portmone | Public |
| GET | `/api/payments/:id/status` | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸ | Auth |

#### Reviews
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| POST | `/api/reviews` | Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ³ÑƒĞº | Auth |
| GET | `/api/reviews` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑ–Ğ² (Ğ´Ğ»Ñ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¾Ñ—) | Public |
| PUT | `/api/admin/reviews/:id` | ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑƒ | Admin |

#### Profile
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| GET | `/api/profile` | ĞœÑ–Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ | Auth |
| PUT | `/api/profile` | ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ | Auth |
| GET | `/api/profile/loyalty` | ĞœĞ¾Ñ— ÑˆÑ‚Ğ°Ğ¼Ğ¿Ğ¸ Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ñ– | Auth |

#### Promo Codes
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| POST | `/api/promo-codes/validate` | ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ | Auth |
| GET | `/api/admin/promo-codes` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ñ–Ğ² | Admin |
| POST | `/api/admin/promo-codes` | Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ | Admin |

#### Waitlist
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| POST | `/api/waitlist` | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ² ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¾Ñ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ | Auth |
| GET | `/api/waitlist/my` | ĞœĞ¾Ñ— Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² Ğ¾Ñ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ– | Auth |
| DELETE | `/api/waitlist/:id` | Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ğ· Ğ¾Ñ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ | Auth |

#### Admin
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| GET | `/api/admin/analytics` | ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ° | Admin |
| GET | `/api/admin/settings` | ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ°Ğ¹Ñ‚Ñƒ | Admin |
| PUT | `/api/admin/settings` | ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ | Admin |
| GET | `/api/admin/users` | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² | Admin |
| PUT | `/api/admin/users/:id/role` | Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ | Owner |

#### Schedule
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| GET | `/api/master/schedule` | ĞœÑ–Ğ¹ Ñ€Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ | Master |
| GET | `/api/admin/schedule/:masterId` | Ğ Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ° | Admin |
| PUT | `/api/admin/schedule/:masterId` | ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ | Admin |

#### Google Calendar
| Method | Path | ĞĞ¿Ğ¸Ñ | Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ |
|--------|------|------|--------|
| POST | `/api/master/calendar/connect` | ĞŸÑ–Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğ¸ GCal | Master |
| POST | `/api/master/calendar/sync` | Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸ | Master |
| DELETE | `/api/master/calendar/disconnect` | Ğ’Ñ–Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğ¸ | Master |

---

## 7. Telegram Bot

### ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸ Ñ‚Ğ° Ğ¾Ğ±Ñ€Ğ¾Ğ±Ğ½Ğ¸ĞºĞ¸

```
/start â€” ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚Ğ°Ğ½Ğ½Ñ + ĞºĞ½Ğ¾Ğ¿ĞºĞ° "Ğ£Ğ²Ñ–Ğ¹Ñ‚Ğ¸" (WebApp)
```

### ĞŸĞ¾Ñ‚Ñ–Ğº /start

```mermaid
sequenceDiagram
    participant U as User
    participant B as Bot
    participant DB as Database

    U->>B: /start
    B->>DB: Check if user exists
    alt New user
        B->>DB: Create user record
        B->>U: Welcome message + WebApp button
    else Existing user
        B->>U: Welcome back + WebApp button
    end
```

### Inline ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ°

Ğ‘Ğ¾Ñ‚ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¿ĞµÑ€ĞµĞ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ:
1. Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ñƒ â€” ĞºĞ½Ğ¾Ğ¿ĞºĞ° WebApp
2. Ğ¡Ğ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ â€” Ğ½Ğ°Ğ³Ğ°Ğ´ÑƒĞ²Ğ°Ğ½Ğ½Ñ, Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½Ñ, Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ Ğ½Ğ° Ğ²Ñ–Ğ´Ğ³ÑƒĞº
3. Callback-ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½ÑÑ… (Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğ¸/ÑĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸Ñ)

---

## 8. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ

### Ğ¢Ğ¸Ğ¿Ğ¸ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ Ñ‚Ğ° Ñ‚Ñ€Ğ¸Ğ³ĞµÑ€Ğ¸

```mermaid
graph LR
    subgraph Triggers
        BC[Booking Created]
        BCF[Booking Confirmed]
        BCA[Booking Cancelled]
        CRON24[Cron: 24h before]
        CRON2[Cron: 2h before]
        BCOMP[Booking Completed]
        WL[Waitlist Slot Available]
        PROMO[New Promotion]
        CRON_EVE[Cron: Evening daily]
    end

    subgraph Queue - BullMQ
        Q[Redis Queue]
    end

    subgraph Worker
        W[Notification Worker]
    end

    subgraph Recipients
        CLIENT[Client via Bot]
        MASTER[Master via Bot]
        ADMIN[Admin via Bot]
    end

    BC --> Q
    BCF --> Q
    BCA --> Q
    CRON24 --> Q
    CRON2 --> Q
    BCOMP --> Q
    WL --> Q
    PROMO --> Q
    CRON_EVE --> Q

    Q --> W
    W --> CLIENT
    W --> MASTER
    W --> ADMIN
```

### Ğ Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ Cron-Ğ·Ğ°Ğ´Ğ°Ñ‡

| Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ | ĞĞ¿Ğ¸Ñ |
|--------|---------|------|
| ĞĞ°Ğ³Ğ°Ğ´ÑƒĞ²Ğ°Ğ½Ğ½Ñ 24Ğ³ | Ğ©Ğ¾Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ¸ | Ğ—Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ‡ĞµÑ€ĞµĞ· 24Ğ³, Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸ Ğ½Ğ°Ğ³Ğ°Ğ´ÑƒĞ²Ğ°Ğ½Ğ½Ñ |
| ĞĞ°Ğ³Ğ°Ğ´ÑƒĞ²Ğ°Ğ½Ğ½Ñ 2Ğ³ | ĞšĞ¾Ğ¶Ğ½Ñ– 15 Ñ…Ğ² | Ğ—Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ‡ĞµÑ€ĞµĞ· 2Ğ³, Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸ Ğ½Ğ°Ğ³Ğ°Ğ´ÑƒĞ²Ğ°Ğ½Ğ½Ñ |
| Ğ—Ğ°Ğ¿Ğ¸Ñ‚ Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑƒ | Ğ©Ğ¾Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ¸ | Ğ—Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ñ– Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ±ĞµĞ· Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑƒ (Ñ‡ĞµÑ€ĞµĞ· 2Ğ³ Ğ¿Ñ–ÑĞ»Ñ) |
| Ğ Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ Ğ½Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° | 20:00 Ñ‰Ğ¾Ğ´Ğ½Ñ | Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸ Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ğ°Ğ¼ Ñ€Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ Ğ½Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° |
| ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° waitlist | ĞšĞ¾Ğ¶Ğ½Ñ– 30 Ñ…Ğ² | ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ñ‡Ğ¸ Ğ·'ÑĞ²Ğ¸Ğ»Ğ¸ÑÑŒ Ğ²Ñ–Ğ»ÑŒĞ½Ñ– ÑĞ»Ğ¾Ñ‚Ğ¸ |
| Ğ©Ğ¾Ğ´ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ·Ğ²Ñ–Ñ‚ Ğ°Ğ´Ğ¼Ñ–Ğ½Ñƒ | 21:00 Ñ‰Ğ¾Ğ´Ğ½Ñ | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ·Ğ° Ğ´ĞµĞ½ÑŒ |

---

## 9. ĞŸĞ»Ğ°Ñ‚Ñ–Ğ¶Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°

### ĞŸĞ¾Ñ‚Ñ–Ğº Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Portmone

```mermaid
sequenceDiagram
    participant C as Client TMA
    participant API as Backend
    participant P as Portmone
    participant DB as Database

    C->>API: POST /payments/create
    API->>DB: Create payment record - pending
    API->>P: Create payment session
    P->>API: Payment URL
    API->>C: Redirect to payment URL
    C->>P: Pay
    P->>API: POST /payments/callback - webhook
    API->>API: Verify signature
    API->>DB: Update payment status
    API->>DB: Update booking status
    alt Payment success
        API->>C: Notify via bot - booking confirmed
    else Payment failed
        API->>C: Notify via bot - payment failed
    end
```

### ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ñƒ

- Ğ’Ñ–Ğ´ÑĞ¾Ñ‚Ğ¾Ğº Ğ´ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ñƒ Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ² `site_settings` (ĞºĞ»ÑÑ‡: `deposit_percent`)
- Ğ—Ğ° Ğ·Ğ°Ğ¼Ğ¾Ğ²Ñ‡ÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼: 50%
- ĞĞ´Ğ¼Ñ–Ğ½ Ğ¼Ğ¾Ğ¶Ğµ Ğ·Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
- ĞŸÑ€Ğ¸ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ– Ğ±Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ: `deposit_amount = total_price * deposit_percent / 100`

---

## 10. ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ñ–

### Ğ›Ğ¾Ğ³Ñ–ĞºĞ° ÑˆÑ‚Ğ°Ğ¼Ğ¿Ñ–Ğ²

```mermaid
stateDiagram-v2
    [*] --> Stamp1: First visit
    Stamp1 --> Stamp2: Second visit
    Stamp2 --> Stamp3: Third visit
    Stamp3 --> StampN: ...
    StampN --> Reward: N-th visit = FREE
    Reward --> Stamp1: Reset counter
```

- N Ğ·Ğ°Ğ´Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ² `loyalty_settings.stamps_for_reward`
- Ğ¨Ñ‚Ğ°Ğ¼Ğ¿ Ğ½Ğ°Ñ€Ğ°Ñ…Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¿Ñ–ÑĞ»Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ `completed`
- Ğ‘ĞµĞ·ĞºĞ¾ÑˆÑ‚Ğ¾Ğ²Ğ½Ğ° Ğ¿Ğ¾ÑĞ»ÑƒĞ³Ğ° â€” Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ğ· Ğ¿ĞµÑ€ĞµĞ»Ñ–ĞºÑƒ `eligible_services`
- ĞĞ´Ğ¼Ñ–Ğ½ ĞºĞµÑ€ÑƒÑ” Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ

---

## 11. i18n â€” ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¼Ğ¾Ğ²Ğ½Ñ–ÑÑ‚ÑŒ

### ĞŸÑ–Ğ´Ñ…Ñ–Ğ´

1. **Ğ†Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ** â€” ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ñ– Ğ¿ĞµÑ€ĞµĞºĞ»Ğ°Ğ´Ğ¸ Ñ‡ĞµÑ€ĞµĞ· `react-i18next` (Ñ„Ğ°Ğ¹Ğ»Ğ¸ `uk.json`, `en.json`, `ru.json`)
2. **ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ· Ğ‘Ğ”** â€” Ğ¿Ğ¾Ğ»Ñ `name`, `description` Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°ÑÑ‚ÑŒÑÑ ÑĞº JSONB:
   ```json
   {
     "uk": "ĞšĞ»Ğ°ÑĞ¸Ñ‡Ğ½Ğ¸Ğ¹ Ğ¼Ğ°ÑĞ°Ğ¶",
     "en": "Classic massage",
     "ru": "ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¼Ğ°ÑÑĞ°Ğ¶"
   }
   ```
3. **Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ¼Ğ¾Ğ²Ğ¸** â€” Ğ· `Telegram.WebApp.initDataUnsafe.user.language_code`
4. **ĞŸĞµÑ€ĞµĞ¼Ğ¸ĞºĞ°Ñ‡** â€” Ğ² Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»Ñ–, Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ² `users.language`

### Ğ¥ÑƒĞº Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ Ğ· Ğ‘Ğ”

```typescript
// useTranslatedContent.ts
function useTranslatedContent<T>(content: Record<string, T>): T {
  const { i18n } = useTranslation();
  const lang = i18n.language; // 'uk' | 'en' | 'ru'
  return content[lang] || content['uk']; // fallback to Ukrainian
}
```

---

## 12. Ğ Ğ¾Ğ»Ñ– Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿

### ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ

| Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ | Client | Master | Admin | Owner |
|---------|--------|--------|-------|-------|
| ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´ Ğ¿Ğ¾ÑĞ»ÑƒĞ³ | âœ… | âœ… | âœ… | âœ… |
| Ğ‘Ñ€Ğ¾Ğ½ÑĞ²Ğ°Ğ½Ğ½Ñ | âœ… | âœ… | âœ… | âœ… |
| Ğ¡Ğ²Ñ–Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ | âœ… | âœ… | âœ… | âœ… |
| Ğ¡Ğ²Ñ–Ğ¹ Ñ€Ğ¾Ğ·ĞºĞ»Ğ°Ğ´ | âŒ | âœ… | âŒ | âŒ |
| Ğ’Ñ–Ğ´Ğ¼Ñ–Ñ‚ĞºĞ° Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ | âŒ | âœ… | âœ… | âœ… |
| Ğ¡Ğ²Ğ¾Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° | âŒ | âœ… | âŒ | âŒ |
| Google Calendar sync | âŒ | âœ… | âŒ | âŒ |
| CRUD Ğ¿Ğ¾ÑĞ»ÑƒĞ³ | âŒ | âŒ | âœ… | âœ… |
| CRUD Ğ¼Ğ°Ğ¹ÑÑ‚Ñ€Ñ–Ğ² | âŒ | âŒ | âœ… | âœ… |
| Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ñ€Ğ¾Ğ·ĞºĞ»Ğ°Ğ´Ğ¾Ğ¼ | âŒ | âŒ | âœ… | âœ… |
| Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¾Ğ¼ | âŒ | âŒ | âœ… | âœ… |
| ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ²Ñ–Ğ´Ğ³ÑƒĞºÑ–Ğ² | âŒ | âŒ | âœ… | âœ… |
| ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´Ğ¸ | âŒ | âŒ | âœ… | âœ… |
| Ğ›Ğ¾ÑĞ»ÑŒĞ½Ñ–ÑÑ‚ÑŒ | âŒ | âŒ | âœ… | âœ… |
| ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ° | âŒ | âŒ | âœ… | âœ… |
| ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ°Ğ¹Ñ‚Ñƒ | âŒ | âŒ | âœ… | âœ… |
| Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ°Ğ¼Ğ¸ | âŒ | âŒ | âŒ | âœ… |
| Ğ¤Ñ–Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ– Ğ·Ğ²Ñ–Ñ‚Ğ¸ | âŒ | âŒ | âŒ | âœ… |

---

## 13. CI/CD Ñ‚Ğ° Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹

### GitHub Actions Pipeline

```mermaid
graph LR
    PUSH[Git Push] --> LINT[ESLint + Prettier]
    LINT --> TEST[Unit Tests]
    TEST --> BUILD[Build]
    BUILD --> DEPLOY_FE[Deploy Frontend to Vercel]
    BUILD --> DEPLOY_BE[Deploy Backend to Railway]
    DEPLOY_BE --> MIGRATE[Run Prisma Migrations]
```

### Ğ¡ĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğ°

| Ğ¡ĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ¸Ñ‰Ğµ | Frontend | Backend | DB |
|------------|----------|---------|-----|
| Development | localhost:5173 | localhost:3000 | Local PostgreSQL |
| Staging | staging.vercel.app | staging.railway.app | Supabase staging |
| Production | prod.vercel.app | prod.railway.app | Supabase production |

---
